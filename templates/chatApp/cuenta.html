{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - Club Almac√©n</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/pages-topbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
</head>
<body>
    <!-- ==================== TOPBAR UNIFICADO ==================== -->
    <div class="pages-topbar">
        <div class="pages-topbar-top">
            <div class="container">
                <div class="topbar-schedule">
                    üìÖ Horario: Lunes a Viernes de 09:30 a 14:00 y de 15:00 a 18:00hrs.
                </div>
                <div class="top-actions">
                    <a class="btn-cta btn-quote" href="{% url 'chatApp:catalog' %}">Cotizar</a>
                    <a class="btn-cta btn-contact" href="{% url 'chatApp:chat' %}#contacto">Cont√°ctenos</a>
                </div>
            </div>
        </div>

        <div class="pages-topbar-main">
            <div class="container">
                <div class="topbar-logo">
                    <div class="topbar-logo-placeholder">
                        Logo<br>Club Almac√©n
                    </div>
                </div>

                <nav class="pages-topbar-nav">
                    <a href="{% url 'chatApp:chat' %}">INICIO</a>
                    <a href="{% url 'chatApp:profile' %}" class="active">MI PERFIL</a>
                    <a href="{% url 'chatApp:catalog' %}">CAT√ÅLOGO</a>
                </nav>

                <a href="{% url 'chatApp:chat' %}" class="btn-back">
                    ‚Üê Volver al Inicio
                </a>
            </div>
        </div>
    </div>

    <!-- ==================== CONTENIDO PRINCIPAL ==================== -->
    <main class="profile-container">
        <div class="profile-header">
            <h1>Mi Perfil</h1>
            <p>Gestiona tu informaci√≥n personal y configuraci√≥n de cuenta</p>
        </div>

        <div class="profile-grid">
            <!-- Sidebar con foto de perfil -->
            <aside class="profile-sidebar">
                <div class="profile-photo-container">
                    {% if profile.foto_perfil %}
                    <img src="{{ profile.foto_perfil.url }}" alt="Foto de perfil" class="profile-photo" id="profilePhoto">
                    {% else %}
                    <div class="profile-photo-placeholder" id="profilePhotoPlaceholder">
                        {{ user.username|slice:":1"|upper }}
                    </div>
                    {% endif %}
                    
                    <button type="button" class="photo-upload-btn" onclick="document.getElementById('photoInput').click()">
                        üì∑
                    </button>
                    <input type="file" id="photoInput" accept="image/*" onchange="uploadPhoto(this)">
                </div>

                <div class="profile-username">{{ user.username }}</div>
                <div class="profile-email">{{ user.email }}</div>

                <div class="photo-actions">
                    <button type="button" class="btn-change-photo" onclick="document.getElementById('photoInput').click()">
                        Cambiar Foto
                    </button>
                    {% if profile.foto_perfil %}
                    <button type="button" class="btn-delete-photo" onclick="deletePhoto()">
                        Eliminar
                    </button>
                    {% endif %}
                </div>

                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-value">{{ profile.fecha_creacion|date:"Y" }}</span>
                        <span class="stat-label">Miembro desde</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">‚úì</span>
                        <span class="stat-label">Activo</span>
                    </div>
                </div>
            </aside>

            <!-- Contenido principal -->
            <div class="profile-content">
                <!-- Informaci√≥n Personal -->
                <section class="profile-section">
                    <div class="section-header">
                        <span class="section-icon">üë§</span>
                        <h2 class="section-title">Informaci√≥n Personal</h2>
                    </div>

                    <form id="personalInfoForm" class="profile-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="username">Usuario *</label>
                                <input type="text" id="username" value="{{ user.username }}" disabled>
                            </div>
                            <div class="form-group">
                                <label for="email">Correo Electr√≥nico *</label>
                                <input type="email" id="email" value="{{ user.email }}" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="nombreCompleto">Nombre Completo</label>
                                <input type="text" id="nombreCompleto" value="{{ profile.nombre_completo }}">
                            </div>
                            <div class="form-group">
                                <label for="telefono">Tel√©fono</label>
                                <input type="tel" id="telefono" value="{{ profile.telefono }}" placeholder="+56912345678">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="whatsapp">WhatsApp</label>
                                <input type="tel" id="whatsapp" value="{{ profile.whatsapp }}" placeholder="+56912345678">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-cancel" onclick="location.reload()">Cancelar</button>
                            <button type="submit" class="btn-save">Guardar Cambios</button>
                        </div>
                    </form>
                </section>

                <!-- Informaci√≥n del Negocio -->
                <section class="profile-section">
                    <div class="section-header">
                        <span class="section-icon">üè™</span>
                        <h2 class="section-title">Informaci√≥n del Negocio</h2>
                    </div>

                    <form id="businessInfoForm" class="profile-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nombreNegocio">Nombre del Negocio</label>
                                <input type="text" id="nombreNegocio" value="{{ profile.nombre_negocio }}">
                            </div>
                            <div class="form-group">
                                <label for="tipoNegocio">Tipo de Negocio</label>
                                <select id="tipoNegocio">
                                    <option value="">Seleccione una opci√≥n</option>
                                    <option value="almacen" {% if profile.tipo_negocio == 'almacen' %}selected{% endif %}>Almac√©n</option>
                                    <option value="minimarket" {% if profile.tipo_negocio == 'minimarket' %}selected{% endif %}>Minimarket</option>
                                    <option value="botilleria" {% if profile.tipo_negocio == 'botilleria' %}selected{% endif %}>Botiller√≠a</option>
                                    <option value="panaderia" {% if profile.tipo_negocio == 'panaderia' %}selected{% endif %}>Panader√≠a</option>
                                    <option value="ferreteria" {% if profile.tipo_negocio == 'ferreteria' %}selected{% endif %}>Ferreter√≠a</option>
                                    <option value="farmacia" {% if profile.tipo_negocio == 'farmacia' %}selected{% endif %}>Farmacia</option>
                                    <option value="bazar" {% if profile.tipo_negocio == 'bazar' %}selected{% endif %}>Bazar</option>
                                    <option value="otro" {% if profile.tipo_negocio == 'otro' %}selected{% endif %}>Otro</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="relacionNegocio">Relaci√≥n con el Negocio</label>
                                <select id="relacionNegocio">
                                    <option value="">Seleccione una opci√≥n</option>
                                    <option value="dueno" {% if profile.relacion_negocio == 'dueno' %}selected{% endif %}>Due√±o</option>
                                    <option value="conyuge" {% if profile.relacion_negocio == 'conyuge' %}selected{% endif %}>C√≥nyuge</option>
                                    <option value="hijo" {% if profile.relacion_negocio == 'hijo' %}selected{% endif %}>Hijo/a</option>
                                    <option value="trabajador" {% if profile.relacion_negocio == 'trabajador' %}selected{% endif %}>Trabajador</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="comuna">Comuna</label>
                                <input type="text" id="comuna" value="{{ profile.comuna }}">
                            </div>
                            <div class="form-group">
                                <label for="region">Regi√≥n</label>
                                <input type="text" id="region" value="{{ profile.region }}">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="direccion">Direcci√≥n</label>
                                <input type="text" id="direccion" value="{{ profile.direccion }}">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-cancel" onclick="location.reload()">Cancelar</button>
                            <button type="submit" class="btn-save">Guardar Cambios</button>
                        </div>
                    </form>
                </section>

                <!-- Preferencias -->
                <section class="profile-section">
                    <div class="section-header">
                        <span class="section-icon">‚öôÔ∏è</span>
                        <h2 class="section-title">Preferencias</h2>
                    </div>

                    <form id="preferencesForm" class="profile-form">
                        <div class="checkbox-group">
                            <input type="checkbox" id="notificaciones" {% if profile.recibir_notificaciones %}checked{% endif %}>
                            <label for="notificaciones">Recibir notificaciones por email</label>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="newsletter" {% if profile.recibir_newsletter %}checked{% endif %}>
                            <label for="newsletter">Suscribirse al bolet√≠n informativo</label>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-save">Guardar Preferencias</button>
                        </div>
                    </form>
                </section>

                <!-- Cambiar Contrase√±a -->
                <section class="profile-section">
                    <div class="section-header">
                        <span class="section-icon">üîí</span>
                        <h2 class="section-title">Seguridad</h2>
                    </div>

                    <form id="passwordForm" class="profile-form">
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="currentPassword">Contrase√±a Actual</label>
                                <input type="password" id="currentPassword" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="newPassword">Nueva Contrase√±a</label>
                                <input type="password" id="newPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirmar Nueva Contrase√±a</label>
                                <input type="password" id="confirmPassword" required>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-cancel" onclick="document.getElementById('passwordForm').reset()">Cancelar</button>
                            <button type="submit" class="btn-save">Cambiar Contrase√±a</button>
                        </div>
                    </form>
                </section>

                <!-- Zona de Peligro -->
                <section class="profile-section danger-zone">
                    <div class="section-header">
                        <span class="section-icon">‚ö†Ô∏è</span>
                        <h2 class="section-title">Zona de Peligro</h2>
                    </div>

                    <div class="danger-actions">
                        <div class="danger-item">
                            <div class="danger-info">
                                <h4>Eliminar Cuenta</h4>
                                <p>Una vez eliminada tu cuenta, no hay vuelta atr√°s. Por favor, estate seguro.</p>
                            </div>
                            <button type="button" class="btn-danger" onclick="confirmDeleteAccount()">
                                Eliminar Cuenta
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- CSRF Form -->
    <form id="csrf-form" style="display: none">{% csrf_token %}</form>

    <!-- Scripts -->
    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/profile.js' %}"></script>
</body>
</html>